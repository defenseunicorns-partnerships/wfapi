kind: ZarfPackageConfig
metadata:
  name: wfapi
  description: Deploy WF API
  version: 0.0.7 # x-release-please-version

variables:
  - name: IRSA_ROLE_ARN
    description: The ARN of the IAM role to associate with the service account for IRSA.
    default: ""
    sensitive: true
  - name: CREATE_ROLE_BINDING
    description: Whether to create a role binding for the service account. f this is set to true
    default: "true"
    sensitive: false
    pattern: "^(true|false)$"
  - name: EXISTING_ROLE_NAME
    description: The name of an existing role to bind to the service account.
    default: "server-role"
    sensitive: false
  - name: UDS_PACKAGE_ENABLED
    description: Whether to enable the UDS package custom resource
    default: "true"
    sensitive: false
    pattern: "^(true|false)$"
  - name: UDS_PACKAGE_EXPOSE_HOST
    description: The hostname to use when creating the VirtualService
    default: "wfapi"
    sensitive: false

components:
  - name: wfapi
    required: true
    charts:
      - name: wfapi
        localPath: ../chart
        namespace: argo
        version: 0.0.7 # x-release-please-version
        valuesFiles:
          - values.yaml
    actions:
      onDeploy:
        onSuccess:
          - description: Restart the deployment
            cmd: ./zarf tools kubectl rollout restart deployment wfapi -n argo
    images:
      - ghcr.io/defenseunicorns/wfapi/containers/wfapi:0.0.7 # x-release-please-version
