tasks:
  - name: compose-up
    description: Use Docker Compose to bring up a lightweight version of the stack locally
    actions:
      - cmd: docker compose -f test/docker-compose.yml -p wfapi up --remove-orphans -d --build
  - name: compose-down
    description: Bring down the Docker Compose stack
    actions:
      - cmd: docker compose -f test/docker-compose.yml -p wfapi down --remove-orphans --volumes
  - name: test-platform-up
    description: Bring up the test cluster. Requires Docker, k3d.
    actions:
      - cmd: |
          ./uds deploy k3d-core-slim-dev:0.22.0 --confirm --no-progress
  - name: test-platform-down
    description: Bring down the test cluster
    actions:
      - cmd: |
          k3d cluster delete uds
  - name: test-app-test
    description: Run tests against the app
    actions:
      - cmd: |
          echo "TODO: Implement tests"
  - name: test
    description: Full end-to-end test suite as a single command for CI
    actions:
      - task: test-platform-down
      - task: test-platform-up
      - task: build
      - task: test-app-up
      - task: test-app-test
      - task: test-platform-down
